# Need to be a member of Schema Admins and Enterprise Admins

# Add roles and features for Mailbox
Install-WindowsFeature NET-Framework-45-Features, Server-Media-Foundation, RPC-over-HTTP-proxy, RSAT-Clustering, RSAT-Clustering-CmdInterface, RSAT-Clustering-Mgmt, RSAT-Clustering-PowerShell, WAS-Process-Model, Web-Asp-Net45, Web-Basic-Auth, Web-Client-Auth, Web-Digest-Auth, Web-Dir-Browsing, Web-Dyn-Compression, Web-Http-Errors, Web-Http-Logging, Web-Http-Redirect, Web-Http-Tracing, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Lgcy-Mgmt-Console, Web-Metabase, Web-Mgmt-Console, Web-Mgmt-Service, Web-Net-Ext45, Web-Request-Monitor, Web-Server, Web-Stat-Compression, Web-Static-Content, Web-Windows-Auth, Web-WMI, Windows-Identity-Foundation, RSAT-ADDS

# Install .NET Framework 4.8
ndp481-web.exe

# Install Visual C++ Runtime 2012
vcredist_x64-2012.exe

# Install Visual C++ Runtime 2013
vcredist_x64-2013.exe

# Install IIS URL Rewrite Module
rewrite_amd64_en-US.msi

# Install Unified Communications Managed API
UcmaRuntimeSetup.exe

# Install Exchange via the last CU released
# https://learn.microsoft.com/en-us/exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019#exchange-server-2019
# Not the ones that end in SU
ExchangeServer2019-x64-CU14.ISO
# Mount the ISO.  Assuming it's mounted as E:
# Note the last option /DoNotEnableEP disable installing Extended Protection
E:\Setup.exe /IAcceptExchangeServerLicenseTerms_DiagnosticDataOFF /mode:Install /r:MB /DoNotEnableEP

# Search for the latest Exchange 2019 Security Update
# https://learn.microsoft.com/en-us/exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019#exchange-server-2019
# Now grab the latest that ends with SU


# Set Message Tracking Log to 90 days instead of 30
Get-TransportService | Set-TransportService -MessageTrackingLogMaxAge 90
